<div class="flex flex-col h-screen">
  <app-navbar></app-navbar>
  
  <div class="flex flex-1 overflow-hidden">
    <app-sidebar></app-sidebar>
    
    <main class="flex-1 overflow-y-auto bg-gray-50 p-8">
      <div class="max-w-3xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Registrar Uso de Cupom</h1>
        <p class="text-gray-600 mb-8">Registre o uso de um cupom por uma loja específica</p>

        <div *ngIf="successMessage" class="mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-lg">
          {{ successMessage }}
        </div>

        <div *ngIf="errorMessage" class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg">
          {{ errorMessage }}
        </div>

        <form (ngSubmit)="onSubmit()" #usoCupomForm="ngForm" class="card">
          <div class="mb-6">
            <label for="cupom" class="block text-gray-700 font-semibold mb-2">
              Cupom <span class="text-red-500">*</span>
            </label>
            <select
              id="cupom"
              name="cupom"
              [(ngModel)]="cupomId"
              required
              class="input-field"
              (change)="successMessage = ''; errorMessage = ''"
            >
              <option value="0">Selecione um cupom</option>
              <option *ngFor="let cupom of cupons" [value]="cupom.id">
                {{ cupom.codigo }} - {{ cupom.loja?.nome || 'Todas as lojas' }} - {{ getCupomInfo(cupom.id!) }}
              </option>
            </select>
            <p *ngIf="cupomId > 0" class="text-sm text-gray-600 mt-1">
              {{ getCupomInfo(cupomId) }}
            </p>
          </div>

          <div class="mb-6">
            <label for="loja" class="block text-gray-700 font-semibold mb-2">
              Loja <span class="text-red-500">*</span>
            </label>
            <select
              id="loja"
              name="loja"
              [(ngModel)]="lojaId"
              required
              class="input-field"
              (change)="successMessage = ''; errorMessage = ''"
            >
              <option value="0">Selecione uma loja</option>
              <option *ngFor="let loja of lojas" [value]="loja.id">
                {{ loja.nome }} - {{ loja.cnpj }}
              </option>
            </select>
          </div>

          <div class="mb-6">
            <label for="valorPedido" class="block text-gray-700 font-semibold mb-2">
              Valor do Pedido (R$) <span class="text-red-500">*</span>
            </label>
            <input
              type="number"
              id="valorPedido"
              name="valorPedido"
              [(ngModel)]="valorPedido"
              required
              min="0.01"
              step="0.01"
              class="input-field"
              placeholder="0.00"
              (input)="successMessage = ''; errorMessage = ''"
            />
          </div>

          <div class="flex gap-4">
            <button
              type="submit"
              [disabled]="loading || !usoCupomForm.form.valid || cupomId === 0 || lojaId === 0"
              class="flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span *ngIf="!loading">Registrar Uso</span>
              <span *ngIf="loading">Processando...</span>
            </button>

            <button
              type="button"
              (click)="cupomId = 0; lojaId = 0; valorPedido = 0; successMessage = ''; errorMessage = ''"
              class="px-6 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition duration-200"
            >
              Limpar
            </button>
          </div>
        </form>

        <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <h3 class="font-semibold text-blue-800 mb-2">ℹ️ Informações</h3>
          <ul class="text-sm text-blue-700 space-y-1">
            <li>• Apenas cupons ativos e disponíveis são listados</li>
            <li>• O sistema valida se o cupom pode ser usado na loja selecionada</li>
            <li>• O desconto será calculado automaticamente com base no tipo (percentual ou fixo)</li>
            <li>• A quantidade utilizada do cupom será incrementada após o registro</li>
          </ul>
        </div>
      </div>
    </main>
  </div>
</div>
